{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"express\"","webpack:///./src/database/database.ts","webpack:///external \"config\"","webpack:///external \"passport\"","webpack:///./src/auth/issueJWT.ts","webpack:///./src/index.ts","webpack:///external \"http\"","webpack:///./src/app.ts","webpack:///external \"cors\"","webpack:///external \"morgan\"","webpack:///./src/middleware/error.ts","webpack:///./src/auth/passport.ts","webpack:///external \"mysql\"","webpack:///external \"passport-jwt\"","webpack:///./src/routes/auth.ts","webpack:///external \"jsonwebtoken\"","webpack:///./src/routes/users.ts","webpack:///./src/routes/programs.ts","webpack:///./src/database/models/program.ts","webpack:///external \"joi\"","webpack:///./src/routes/enrollments.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","dbInfo","password","console","error","process","exit","log","connection","createConnection","connect","err","sqlMessage","threadId","createProgram","program","Promise","resolve","reject","query","description","data","insertID","readPrograms","readProgram","id","updateProgram","deleteProgram","createUser","user","student_id","first_name","last_name","role_id","result","affectedRows","Error","user_id","insertId","readUsers","readUser","readUserByStudentID","payload","sub","iat","Date","now","token","sign","expiresIn","expires","PORT","env","set","server","createServer","listen","on","app","use","initialize","json","urlencoded","extended","authenticate","session","req","res","send","next","status","opts","jwtFromRequest","ExtractJwt","fromAuthHeaderAsBearerToken","secretOrKey","strategy","done","parseInt","passport","router","Router","post","body","jwt","success","params","sendStatus","newUser","message","createdUser","validateProgram","errors","put","delete","programSchema","string","max","required","validate","program_id","patch","status_id","client_id"],"mappings":"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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 5);\n","module.exports = require(\"express\");","import mysql, { ConnectionConfig, OkPacket } from \"mysql\";\nimport User from \"./models/user\";\nimport Program from \"./models/program\";\nimport config from \"config\";\n\nconst dbInfo: ConnectionConfig = config.get(\"dbInfo\");\n\nif (dbInfo.password === \"\") {\n\tconsole.error(\"FATAL: yonsei_DBPWD doesn't defined\");\n\tprocess.exit(1);\n}\nconsole.log(dbInfo.password);\n\nconst connection = mysql.createConnection(dbInfo);\nconnection.connect((err) =>\n\terr\n\t\t? console.error(\"MySQL connection Error: \", err.sqlMessage)\n\t\t: console.log(\"Connected to MySQL with id: \", connection.threadId)\n);\n\nfunction createProgram(program: Program) {\n\treturn new Promise<number>((resolve, reject) => {\n\t\tconnection.query(\n\t\t\t`\n    INSERT INTO programs\n    VALUES(\n      DEFAULT,\n      '${program.name}',\n      '${program.description}'\n\t\t);\n    `,\n\t\t\t(err, data) => (err ? reject(err) : resolve(data.insertID))\n\t\t);\n\t});\n}\n\nfunction readPrograms() {\n\treturn new Promise<Program[]>((resolve, reject) => {\n\t\tconnection.query(\n\t\t\t`\n    SELECT *\n    FROM programs\n    `,\n\t\t\t(err, data) => (err ? reject(err) : resolve(data))\n\t\t);\n\t});\n}\n\nfunction readProgram(id: number) {\n\treturn new Promise<Program>((resolve, reject) => {\n\t\tconnection.query(\n\t\t\t`\n    SELECT *\n    FROM programs\n    WHERE program_id = ${id}\n    `,\n\t\t\t(err, data) => (err ? reject(err) : resolve(data[0]))\n\t\t);\n\t});\n}\n\nfunction updateProgram(id: number, program: Program) {\n\treturn new Promise<Program>((resolve, reject) => {\n\t\tconnection.query(\n\t\t\t`\n    UPDATE programs\n\t\tSET name = '${program.name}', description = '${program.description}'\n\t\tWHERE program_id = ${id};\n    `,\n\t\t\t(err, data) => (err ? reject(err) : resolve(data[0]))\n\t\t);\n\t});\n}\n\nfunction deleteProgram(id: number) {\n\treturn new Promise<Program>((resolve, reject) => {\n\t\tconnection.query(\n\t\t\t`\n    DELETE FROM programs\n    WHERE program_id = ${id};\n    `,\n\t\t\t(err, data) => (err ? reject(err) : resolve(data[0]))\n\t\t);\n\t});\n}\n\nfunction createUser(user: User) {\n\treturn new Promise<User>((resolve, reject) => {\n\t\tconnection.query(\n\t\t\t`\n\t\tINSERT INTO users\n\t\tVALUES (\n\t\t\tDEFAULT,\n\t\t\t'${user.student_id}',\n\t\t\t'${user.password}',\n\t\t\t'${user.first_name}',\n\t\t\t'${user.last_name}',\n\t\t\t${user.role_id}\n\t\t);\n\t\t`,\n\t\t\t(err, result: OkPacket) =>\n\t\t\t\terr\n\t\t\t\t\t? reject(err)\n\t\t\t\t\t: result.affectedRows === 0\n\t\t\t\t\t? reject(new Error(\"insert doesn't work\"))\n\t\t\t\t\t: resolve({ user_id: result.insertId, ...user })\n\t\t);\n\t});\n}\n\nfunction readUsers() {\n\treturn new Promise<User[]>((resolve, reject) => {\n\t\tconnection.query(\n\t\t\t`\n    SELECT *\n    FROM users\n    `,\n\t\t\t(err, data) => (err ? reject(err) : resolve(data))\n\t\t);\n\t});\n}\n\nfunction readUser(id: number) {\n\treturn new Promise<User>((resolve, reject) => {\n\t\tconnection.query(\n\t\t\t`\n    SELECT *\n\t\tFROM users\n\t\tWHERE user_id = ${id}\n    `,\n\t\t\t(err, data) => (err ? reject(err) : resolve(data[0]))\n\t\t);\n\t});\n}\n\nfunction readUserByStudentID(student_id: any) {\n\treturn new Promise<User>((resolve, reject) => {\n\t\tconnection.query(\n\t\t\t`\n    SELECT *\n\t\tFROM users\n\t\tWHERE student_id = ${student_id}\n    `,\n\t\t\t(err, data) => (err ? reject(err) : resolve(data[0]))\n\t\t);\n\t});\n}\n\nexport default {\n\tconnection,\n\tcreateProgram,\n\treadPrograms,\n\treadProgram,\n\tupdateProgram,\n\tdeleteProgram,\n\tcreateUser,\n\treadUsers,\n\treadUser,\n\treadUserByStudentID\n};\n","module.exports = require(\"config\");","module.exports = require(\"passport\");","import jwt from \"jsonwebtoken\";\nimport config from \"config\";\nimport User from \"../database/models/user\";\n\nconst key: string = config.get(\"jwtKey\");\n\nexport default function issueJWT(user: User) {\n\tconst expiresIn = \"1d\";\n\n\tconst payload = {\n\t\tsub: user.user_id,\n\t\tiat: Date.now()\n\t};\n\n\tconst signedToken = jwt.sign(payload, key, {\n\t\texpiresIn: expiresIn\n\t});\n\n\treturn {\n\t\ttoken: `Bearer ${signedToken}`,\n\t\texpires: expiresIn\n\t};\n}\n","import http from \"http\";\nimport app from \"./app\";\nimport config from \"config\";\n\nconsole.log(config.get(\"name\"));\n\nconst PORT = process.env.PORT || \"3900\";\napp.set(\"port\", PORT);\n\nconst server = http.createServer(app);\n\nserver.listen(PORT);\n\nserver.on(\"error\", (err) => {\n\tconsole.log(\"ERROR: \", err);\n});\n\nserver.on(\"listening\", () => {\n\tconsole.log(`Listening on Port ${PORT}...`);\n});\n","module.exports = require(\"http\");","import express from \"express\";\nimport cors from \"cors\";\nimport morgan from \"morgan\";\nimport error from \"./middleware/error\";\nimport passport from \"passport\";\nimport passportConfig from \"./auth/passport\";\npassportConfig(passport);\n\nimport auth from \"./routes/auth\";\nimport users from \"./routes/users\";\nimport programs from \"./routes/programs\";\nimport enrollments from \"./routes/enrollments\";\n\nconst app = express();\n\napp.use(morgan(\"dev\"));\napp.use(cors());\n\napp.use(passport.initialize());\n\napp.use(express.json());\napp.use(express.urlencoded({ extended: true }));\n\napp.use(\"/api/auth\", auth);\napp.use(\"/api/users\", users);\napp.use(\"/api/programs\", programs);\napp.use(\"/api/enrollments\", enrollments);\n\napp.get(\n\t\"/api/protected\",\n\tpassport.authenticate(\"jwt\", { session: false }),\n\t(req, res) => {\n\t\tconsole.log(req.user);\n\t\tres.send(\"you are logged in\");\n\t}\n);\n\napp.use(error);\n\nexport default app;\n","module.exports = require(\"cors\");","module.exports = require(\"morgan\");","import { Request, Response, RequestHandler } from \"express\";\n\nexport default (\n\terr: any,\n\treq: Request,\n\tres: Response,\n\tnext: RequestHandler\n) => {\n\tres.status(500).send(\"Unexpected Server Error :(\");\n};\n","import DB from \"../database/database\";\nimport { PassportStatic } from \"passport\";\nimport config from \"config\";\nimport {\n\tStrategy as JwtStrategy,\n\tExtractJwt,\n\tStrategyOptions\n} from \"passport-jwt\";\n\nconst opts: StrategyOptions = {\n\tjwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),\n\tsecretOrKey: config.get(\"jwtKey\")\n};\n\nconst strategy = new JwtStrategy(opts, async (payload: any, done: any) => {\n\ttry {\n\t\tconst user = await DB.readUser(parseInt(payload.sub));\n\t\tif (user) return done(null, user);\n\t\telse return done(null, false);\n\t} catch (error) {\n\t\treturn done(error, false);\n\t}\n});\n\nexport default (passport: PassportStatic) => passport.use(strategy);\n","module.exports = require(\"mysql\");","module.exports = require(\"passport-jwt\");","import { Router } from \"express\";\nimport DB from \"../database/database\";\nimport issueJWT from \"../auth/issueJWT\";\n\nexport interface authResponse {\n\tsuccess: boolean;\n\tuser: any;\n\ttoken: string;\n\texpires: string;\n}\n\nconst router = Router();\n\nrouter.post(\"/\", async (req, res) => {\n\tconst user = await DB.readUserByStudentID(req.body.student_id);\n\tif (!user) res.status(400).send(\"Invalid Username or Password\");\n\n\tif (req.body.password === user.password) {\n\t\tconst jwt = issueJWT(user);\n\t\tres.json({\n\t\t\tsuccess: true,\n\t\t\tuser: user,\n\t\t\ttoken: jwt.token,\n\t\t\texpires: jwt.expires\n\t\t} as authResponse);\n\t} else {\n\t\tres.status(400).send(\"Invalid Username or Password\");\n\t}\n});\n\nexport default router;\n","module.exports = require(\"jsonwebtoken\");","import { Router } from \"express\";\nimport DB from \"../database/database\";\nimport issueJWT from \"../auth/issueJWT\";\nconst router = Router();\n\nrouter.get(\"/\", async (req, res) => {\n\tres.send(await DB.readUsers());\n});\n\nrouter.get(\"/:id\", async (req, res) => {\n\tconst result = await DB.readUser(parseInt(req.params.id));\n\tresult ? res.send(result) : res.sendStatus(404);\n});\n\nrouter.post(\"/\", async (req, res) => {\n\tconst newUser = req.body;\n\tconst result = await DB.readUserByStudentID(newUser.student_id);\n\tif (result)\n\t\treturn res\n\t\t\t.status(400)\n\t\t\t.json({ success: false, message: \"user already exists\" });\n\n\tconst createdUser = await DB.createUser(req.body);\n\n\tconst jwt = issueJWT(createdUser);\n\tres.json({\n\t\tsuccess: true,\n\t\tuser: createdUser,\n\t\ttoken: jwt.token,\n\t\texpires: jwt.expires\n\t});\n});\n\nexport default router;\n","import { Router } from \"express\";\nimport DB from \"../database/database\";\nimport Program, { validateProgram } from \"../database/models/program\";\n\nconst router = Router();\n\nrouter.get(\"/\", async (req, res) => {\n\tconst result: Program[] = await DB.readPrograms();\n\tres.send(result);\n});\n\nrouter.get(\"/:id\", async (req, res) => {\n\tconst result = await DB.readProgram(parseInt(req.params.id));\n\tresult ? res.send(result) : res.sendStatus(404);\n});\n\nrouter.post(\"/\", async (req, res) => {\n\tconst result = validateProgram(req.body);\n\tif (result.errors) return res.status(400).send(result.errors);\n\tres.send(await DB.createProgram(req.body));\n});\n\nrouter.put(\"/:id\", async (req, res) => {\n\tconst result = validateProgram(req.body);\n\tif (result.errors) return res.status(400).send(result.errors);\n\tres.send(await DB.updateProgram(parseInt(req.params.id), req.body));\n});\n\nrouter.delete(\"/:id\", async (req, res) => {\n\tawait DB.deleteProgram(parseInt(req.params.id));\n\tres.sendStatus(204);\n});\n\nexport default router;\n","import Joi from \"joi\";\n\nexport default interface Program {\n\tprogram_id?: number;\n\tname: string;\n\tdescription: string;\n}\n\nconst programSchema = {\n\tname: Joi.string().max(45).required(),\n\tdescription: Joi.string().max(255).required()\n};\n\nexport const validateProgram = (p: Program) =>\n\tJoi.object(programSchema).validate(p);\n","module.exports = require(\"joi\");","import passport from \"passport\";\nimport { Router } from \"express\";\nimport DB from \"../database/database\";\nimport User from \"../database/models/user\";\nconst router = Router();\n//protected route for RC, RA\n\nrouter.use(passport.authenticate(\"jwt\", { session: false }));\n\nrouter.get(\"/\", (req: any, res) => {\n\tconsole.log(req.user);\n\tDB.connection.query(\n\t\treq.user.role_id === 1\n\t\t\t? `\n        SELECT *\n\t\t\t\tFROM view_enrollments\n\t\t\t\tWHERE client_id = ${req.user.user_id}\n\t\t`\n\t\t\t: `\n        SELECT *\n\t\t\t\tFROM view_enrollments\n\t\t`,\n\t\t(err, data) => {\n\t\t\tif (err) throw new Error(\"server error\");\n\t\t\tres.json({ success: true, data: data });\n\t\t}\n\t);\n});\n\nrouter.post(\"/\", (req: any, res) => {\n\tDB.connection.query(\n\t\t`\n\t\tINSERT INTO enrollments\n\t\tVALUES (\n\t\t\t${req.user?.user_id},\n\t\t\t${req.body.program_id},\n\t\t\tNOW(),\n\t\t\t1\n\t\t) \n\t`,\n\t\t(err, data) => {\n\t\t\tif (err) throw new Error(\"server error\");\n\t\t\tres.json({ success: true });\n\t\t}\n\t);\n});\n\nrouter.patch(\"/\", (req, res) => {\n\tDB.connection.query(\n\t\t`\n\t\tUPDATE enrollments\n\t\tSET status_id = ${req.body.status_id}\n\t\tWHERE program_id=${req.body.program_id} AND client_id=${req.body.client_id}\n\t\t`,\n\t\t(err, data) => {\n\t\t\tif (err) throw new Error(\"server error\");\n\t\t\tres.json({ success: true });\n\t\t}\n\t);\n});\n\nrouter.delete(\"/:id\", (req: any, res) => {\n\tDB.connection.query(\n\t\t`\n\t\tDELETE FROM enrollments\n\t\tWHERE program_id=${req.params.id} AND client_id=${req.user?.user_id}\n\t\t`,\n\t\t(err, data) => {\n\t\t\tif (err) throw new Error(\"server error\");\n\t\t\tres.json({ success: true });\n\t\t}\n\t);\n});\n\nexport default router;\n"],"sourceRoot":""}